(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{229:function(t,n,s){"use strict";s.r(n);var a=s(1),e=Object(a.a)({},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"content"},[s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("在我们完成项目开发后，提交到git，当监听提交后，自动进行编译，并进行项目的部署，是不是一想就很爽，所以下面引入我们的主角 —— gitlab-CI，"),s("a",{attrs:{href:"https://fennay.github.io/gitlab-ci-cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("中文文档"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),t._m(0),t._v(" "),s("p",[t._v("Gitlab-CI 是 GitLab Continuous Integration（Gitlab持续集成）的简称。\n从Gitlab的8.0版本开始，gitlab就全面集成了Gitlab-CI,并且对所有项目默认开启。\n只要在项目仓库的根目录添加.gitlab-ci.yml文件，并且配置了Runner（运行器），那么每一次合并请求（MR）或者push都会触发CI pipeline。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),s("p",[t._v("具体配置见"),s("a",{attrs:{href:"https://fennay.github.io/gitlab-ci-cn/gitlab-ci-yaml.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),s("OutboundLink")],1)]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),s("p",[t._v("如果是下载，调换顺序")]),t._v(" "),t._m(18),s("p",[t._v("个人博客："),s("a",{attrs:{href:"http://recoluan.gitlab.io",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("午后南杂")]),s("OutboundLink")],1)])])},[function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"gitlab-ci"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci","aria-hidden":"true"}},[this._v("#")]),this._v(" Gitlab CI")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"gitlab-runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-runner","aria-hidden":"true"}},[this._v("#")]),this._v(" Gitlab-Runner")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h4",{attrs:{id:"安装gitlab-ci-multi-runner（linux）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab-ci-multi-runner（linux）","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装gitlab-ci-multi-runner（linux）")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加yum源")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装")]),t._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gitlab-ci-multi-runner\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h4",{attrs:{id:"使用-gitlab-ci-multi-runner-注册-specific-runners"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-gitlab-ci-multi-runner-注册-specific-runners","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 gitlab-ci-multi-runner 注册 Specific Runners")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4660406-23e31a052864a7a0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"runners.jpg"}})])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ gitlab-ci-multi-runner register\nRunning "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" system-mode.\n\nPlease enter the gitlab-ci coordinator URL "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e.g. https://gitlab.com/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" 你的URL\n\nPlease enter the gitlab-ci token "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this runner:\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" 你的Token\n\nPlease enter the gitlab-ci description "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this runner:\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" 你对该runner的描述\n\nPlease enter the gitlab-ci tags "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this runner "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("comma separated"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" 该runner的标签\n\nWhether to run untagged builds "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("true/false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" 是否运行没有标记的项目（后期可以改）\n\nWhether to lock Runner to current project "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("true/false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" 是否锁定只运行当前项目（后期可以改）\n\nRegistering runner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". succeeded                     runner"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("9e48baqx\n\nPlease enter the executor: parallels, docker+machine, ssh, virtualbox, docker-ssh+machine, kubernetes, docker, docker-ssh, shell:\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" 选择runner的类型（根据你的需求选择，我选择的shell，我的项目是node项目）\n\nRunner registered successfully. Feel "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" to start it, but "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" it's running already the config should be automatically reloaded"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("ol",[s("li",[t._v("首先你的项目中的 "),s("code",[t._v("getlab-runner.yml")]),t._v(" 文件中的命令需要的环境，你的runner所在的服务器是必须要搭好的，必须你需要执行 "),s("code",[t._v("npm install")]),t._v(" 和 "),s("code",[t._v("npm run build")]),t._v(" ，那你的服务器必须要有node环境；")]),t._v(" "),s("li",[t._v("runner的类型比较重要，你必须要清楚你需要一个什么类型的runner。比如，开始我是需要一个能够运行node项目的runner，但是网上的很多教程统一都是都选择docker，这个时候你电脑上必须要安装了docker才可以，因为这相当于在docker里面又安装了一个docker（docker in docker），所以对于我的需求来说，我选择shell就可以了；")]),t._v(" "),s("li",[t._v("通过Gitlab中某个项目的 "),s("code",[t._v("Settings")]),t._v(" 下的 "),s("code",[t._v("CI/CD Pipelines")]),t._v(" 按钮进入的页面中得到的URL和Token所注册的runner只服务于本项目，当你在其他项目的当前页面时，可以选择让这个runner为当前项目开启服务。")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"配置-gitlab-runner-yml"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-gitlab-runner-yml","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 gitlab-runner.yml")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("mage: node:9.11.1\n\npages:\n cache:\n   paths:\n   - node_modules/\n\n script:\n - cnpm "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n - "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build\n - "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf /data/ftp/http/files/scfAdminDoc\n - "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" ./scfAdminDoc /data/ftp/http/files/\n artifacts:\n   paths:\n   - public\n only:\n - master\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"其他"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他","aria-hidden":"true"}},[this._v("#")]),this._v(" 其他")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h4",{attrs:{id:"代码推送到gitlab上之后，一直是pending状态，要等很久才pick到一个runner来执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码推送到gitlab上之后，一直是pending状态，要等很久才pick到一个runner来执行","aria-hidden":"true"}},[this._v("#")]),this._v(" 代码推送到gitlab上之后，一直是pending状态，要等很久才pick到一个runner来执行")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[this._v("这个现象一般发生在本机注册了多个runner，之前的都删除了，只留下一个，但是当我们在gitlab管理平台移除了某个runner的时候，并没有完全删除记录，当执行的 "),n("code",[this._v("gitlab-ci-multi-runner list")]),this._v(" 的时候你会发现它仍然还在，如果需要彻底删除它，还应该这样做：")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[this._v("cd")]),this._v(" /etc/gitlab-runner\n"),n("span",{pre:!0,attrs:{class:"token function"}},[this._v("ls")]),this._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 你会看到config.toml文件，打开它并删除已有的那些runner记录")]),this._v("\nvim config.toml\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h4",{attrs:{id:"配置node环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置node环境","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置node环境")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ol",[s("li",[t._v("下载node-v9.11.1-linux-x64.tar.xz文件")]),t._v(" "),s("li",[t._v("例如放在 "),s("code",[t._v("/home")]),t._v(" 文件夹"),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入所在目录，解压")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -xvf node-v9.11.1-linux-x64.tar.xz\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重命名文件夹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" node-v9.11.1-linux-x64 nodejs\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 建立软链接，配置全局环境变量（源路径和目标路径为相对路径）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /home/nodejs/bin/npm /usr/local/bin/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /home/nodejs/bin/node /usr/local/bin/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查是否配置成功")]),t._v("\nnode -v\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" -v\n")])])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h4",{attrs:{id:"scp上上传"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#scp上上传","aria-hidden":"true"}},[this._v("#")]),this._v(" scp上上传")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 普通")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" ./public/* root@192.168.0.226:/data/ftp/http/files/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" 源路径/源文件 用户名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("@服务器IP:目标路径\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 免密码")]),t._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" sshpass\nsshpass -p 111111 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" ./public/* root@192.168.0.226:/data/ftp/http/files/\nsshpass -p 密码 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" 源路径/源文件 用户名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("@服务器IP:目标路径\n")])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" root@192.168.0.226:/data/ftp/http/files/ ./public/*\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" 用户名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("@服务器IP:目标路径 源路径/源文件\n")])])])}],!1,null,null,null);e.options.__file="121201.md";n.default=e.exports}}]);